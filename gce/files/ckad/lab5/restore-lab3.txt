sudo apt-get install -y docker-compose apache2-utils
sudo mkdir -p /localdocker/data
sudo chown -R ubuntu:ubuntu /localdocker/
cd /localdocker/
cp ~/files/ckad/lab3/docker-compose.yaml .
sudo docker-compose up -d


mkdir /tmp/data /tmp/nginx

cd ~/files/ckad/lab3
kubectl create -f vol1.yaml
kubectl create -f vol2.yaml

kubectl create -f edited-localregistry.yaml

kubectl get pods,svc,pvc,pv,deploy


kubectl get svc registry --output json | jq '.spec.clusterIP'  | sed 's/"$/:5000"/' | sed 's/^/{ "insecure-registries":[/; s/$/] }/' | tee daemon.json
sudo cp daemon.json /etc/docker/daemon.json
sudo systemctl restart docker.service

( do the same on other nodes )

clusterIP=$(kubectl get svc registry --output json | jq '.spec.clusterIP' | sed 's/"//g')
#sudo docker pull ubuntu
#sudo docker tag ubuntu:latest ${clusterIP}:5000/tagtest
#sudo docker push ${clusterIP}:5000/tagtest

cd ~/files/ckad/lab3/simpleapp
sudo docker build -t simpleapp .
sudo docker tag simpleapp ${clusterIP}:5000/simpleapp
sudo docker push ${clusterIP}:5000/simpleapp
